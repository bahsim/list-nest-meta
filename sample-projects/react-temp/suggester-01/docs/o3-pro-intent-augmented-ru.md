# Инструмент предложения повторного использования кода – Дополненная цель (Утвержденный черновик)

## 1. Цель и видение
Создать интеллектуального помощника, который **активно устраняет дублирование кода** в нашей экосистеме React (микро-фронтенды, общие библиотеки, git субмодули) путем обнаружения потенциальных возможностей повторного использования и предоставления действенных предложений разработчикам через CLI, IDE и CI конвейеры.

## 2. Метрики успеха (Количественные)
| Категория | Метрика | Цель (MVP) | Цель (GA) |
|-----------|---------|------------|-----------|
| Точность | Частота ложноположительных предложений | ≤ 5 % | ≤ 3 % |
| Точность | Частота ложноотрицательных (пропущенных дубликатов) | ≤ 10 % | ≤ 5 % |
| Производительность | Задержка предложений IDE | ≤ 150 мс | ≤ 100 мс |
| Производительность | Время завершения анализа PR (≤ 2 тыс. строк изменений) | ≤ 60 с | ≤ 30 с |
| Производительность | Полное обновление метаданных репозитория (≤ 5 тыс. файлов) | ≤ 2 мин | ≤ 1 мин |
| Принятие | Частота принятия предложений (контролируемые команды) | ≥ 50 % | ≥ 70 % |
| Надежность | Запуски CLI без сбоев | ≥ 99 % | ≥ 99.5 % |

## 3. Область охвата
*В области охвата*
- Типы артефактов: React компоненты, хуки, утилиты/помощники, TS типы/интерфейсы.
- Режимы работы: CLI, IDE (VS Code ≥ 1.85), CI (GitHub Action).
- Локальный анализ по умолчанию с дополнительными облачными воркерами при `allowRemote=true`.
- Непрерывная синхронизация метаданных при слияниях в ветки `main`.

*Вне области охвата (v1)*
- Автоматический рефакторинг кода для использования общих артефактов.
- Поддержка проектов не на TypeScript.
- Ранжирование предложений на основе циклов обратной связи ML (появится после GA).

## 4. Ограничения и границы
| Область | Ограничение |
|---------|-------------|
| Целевые репозитории | Все репозитории, перечисленные в `repos.config.json` (начальный список: `app-shell`, `ui-kit`, `marketing-site`). |
| Среда выполнения | Node ≥ 20, npm ≥ 9. |
| Аппаратное обеспечение | Должен работать в пределах 4 vCPU / 8 ГБ ОЗУ на ноутбуках разработчиков. |
| Совместимость | Расширение VS Code должно поддерживать Windows 10+, macOS 11+, Ubuntu 20.04+. |
| Конфиденциальность | Исходный код не покидает локальную/доверенную инфраструктуру, если не установлен флаг `allowRemote`. |
| Лицензии | Инструмент и его зависимости должны быть совместимы с MIT. |

## 5. Заинтересованные стороны и роли
| Роль | Имя / Slack | Обязанности | Требуется утверждение |
|------|-------------|-------------|----------------------|
| Стратегический лидер | *@product-lead* | Бизнес-ценность и область охвата | ✅ |
| Лидер разработки | *@dev-lead* | Архитектура и поставка | ✅ |
| AI Со-пилот (этот репозиторий) | *o3-pro* | Генерация и консультирование | — |
| Ответственный за QA | *@qa-owner* | Качественные критерии и метрики | ✅ |
| Безопасность | *@sec-lead* | Соответствие конфиденциальности и лицензий | ✅ |

## 6. Ключевые риски и смягчения
| Риск | Вероятность | Влияние | Смягчение |
|------|-------------|---------|-----------|
| Высокий шум предложений раздражает разработчиков | Средняя | Высокое | Настраиваемый порог, постепенное развертывание, сбор отзывов. |
| Парсер AST не справляется с крайним синтаксисом TS | Средняя | Среднее | Использовать `ts-morph`; добавить резервное текстовое сравнение; автоматизированный корпус регрессии. |
| Масштабируемость поиска схожести | Низкая | Высокое | Прототип с косинусным сходством в памяти, план миграции на pgvector. |
| Регрессии производительности расширения IDE | Средняя | Среднее | Набор бенчмарков + профилирование VS Code; ленивая загрузка тяжелых модулей. |

## 7. Критерии приемки / Определение завершенности (MVP)
1. CLI: `reuse-suggest scan <paths>` возвращает предложения с указанными выше метриками точности.
2. GitHub Action публикует комментарии к обзору PR с временем анализа ≤ 60 с.
3. Расширение VS Code показывает встроенные предложения ≤ 150 мс (исключая холодный старт).
4. Хранилище метаданных сохраняет записи артефактов (SQLite) и обновляется при слияниях в `main`.
5. Файл конфигурации `reuse-suggest.config.{json,ts}` поддерживает пороги и игнорирование путей.
6. Все критические риски имеют реализованные смягчения.
7. Все метрики успеха отслеживаются через панель телеметрии.
8. Получено одобрение заинтересованных сторон (таблица в §5).

## 8. Высокоуровневые зависимости и технологические решения
- **Парсинг:** `ts-morph` для извлечения TypeScript AST.
- **Схожесть:** Начальные Jaccard и Levenshtein, путь обновления до embedding + pgvector.
- **Хранение:** SQLite (файловый) для MVP, миграция на Postgres.
- **CI:** Составное действие GitHub Actions.
- **IDE:** Расширение VS Code с использованием `vscode-languageclient`.

## 9. Глоссарий
*Артефакт* – любая переиспользуемая единица кода (компонент, хук, утилита, тип).  
*Предложение* – рекомендация, указывающая разработчикам на существующий артефакт.  
*Порог схожести* – числовое значение, контролирующее, когда выдается предложение.

---
**История изменений**
| Версия | Дата | Автор | Примечания |
|--------|------|-------|------------|
| v0.1 | 2025-07-23 | o3-pro | Первоначальный дополненный черновик для обзора заинтересованными сторонами | 